#!/usr/bin/env bash

ROOT=$(pwd)

cd opencl

# Run single benchmark by name:
if [[ -n "$1" ]]; then
    cd "$1"
    runcecl $SHELL run
    exit $?
fi

set -u

# Run all benchmarks:
rm -rf "$ROOT/logs"
mkdir -p "$ROOT/logs/bad" "$ROOT/logs/good"

for dir in $(ls | sort); do
  echo -n "$(tput bold)rodinia-3.1 $dir$(tput sgr0) ... "
  cd $dir
  runcecl $SHELL run > "$ROOT/log.txt"
  ret=$?
  if [[ $ret -eq 0 ]]; then
    mv "$ROOT/log.txt" "$ROOT/logs/good/$dir"
    echo ok
  else
    mv "$ROOT/log.txt" "$ROOT/logs/bad/$dir"
    echo bad
  fi
  cd ..
done
