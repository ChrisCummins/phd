\section{Motivation}\label{sec:motivation}

%\newsavebox{\IntelSizetIntReduced}
%\begin{lrbox}{\IntelSizetIntReduced}
%  \hspace{1.5em}
%  \begin{lstlisting}
%    kernel void A(global double* a) {
%      int b = get_global_id(0);
%      if (b < -1) {
%        a[b] = 1;
%      }
%    }
%  \end{lstlisting}
%\end{lrbox}
%
%\newsavebox{\OclgrindRaceSwitch}
%\begin{lrbox}{\OclgrindRaceSwitch}
%  \hspace{1.5em}
%  \begin{lstlisting}
%  kernel void A(global int* a, global int* b) {
%    switch (get_global_id(0)) {
%      case 0:
%        a[get_global_id(0)] = b[get_global_id(0) + 13];
%        break;
%      case 2:
%        a[get_global_id(0)] = b[get_global_id(0) + 11];
%        break;
%      case 6:
%        a[get_global_id(0)] = b[get_global_id(0) + 128];
%    }
%    barrier(2);
%  }
%  \end{lstlisting}
%\end{lrbox}
%
%\newsavebox{\AlmostEverythingCrash}
%\begin{lrbox}{\AlmostEverythingCrash}
%  \hspace{1.5em}
%  \begin{lstlisting}
%    kernel void A() {
%      __builtin_astype(d, uint4);
%    }
%  \end{lstlisting}
%\end{lrbox}

\begin{figure}
  \centering %
  \subfloat[This widely used pattern of integer comparison to thread ID is miscompiled on two compilers when optimizations are enabled and the integer literal is negative, causing the \texttt{if} statement to be executed (hand-reduced version of Figure~\ref{lst:intel-size_t-int-unreduced}).]{%
    \noindent\mbox{\parbox{\columnwidth}{\usebox{\IntelSizetIntReduced}}}%
    \label{lst:intel-size_t-int-reduced}
  }\\%
  \subfloat[A race condition in \texttt{switch} statement evaluation causes Oclgrind to sporadically crash when executed with a global size $> 1$, irrespective of optimization level.]{%
    \noindent\mbox{\parbox{\columnwidth}{\usebox{\OclgrindRaceSwitch}}}%
    \label{lst:oclgrind-race-switch}
  }\\%
  \subfloat[Of the 10 compilers we tested, 6 crash with segfault when compiling this malformed kernel.]{%
    \noindent\mbox{\parbox{\columnwidth}{\usebox{\AlmostEverythingCrash}}}%
    \label{lst:almost-everything-crash}
  }\\%
  \caption{Motivating bugs exposed using our approach.}%
  \label{lst:motivation}%
\end{figure}
