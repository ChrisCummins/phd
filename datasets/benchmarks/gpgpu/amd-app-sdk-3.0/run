#!/usr/bin/env bash
set -eu

benchmarks=(
    AdvancedConvolution
    BinomialOption
    BitonicSort
    BlackScholes
    FastWalshTransform
    FloydWarshall
    Histogram
    MatrixMultiplication
    MatrixTranspose
    MonteCarloAsian
    NBody
    PrefixSum
    Reduction
    ScanLargeArrays
    SimpleConvolution
    SobelFilter
)

ROOT=$(pwd)

rm -rf logs
mkdir -p logs/bad logs/good

cd samples/opencl/cl/1.x

for b in ${benchmarks[@]}; do
    echo -n "$(tput bold)amd-app-sdk-3.0 $b$(tput sgr0) ... "
    cd $b/bin/x86_64/Release
    set +e
    runcecl ./$b > $ROOT/log.txt
    ret=$?
    set -e

    if [[ $ret -ne 0 ]]; then
        echo fail
        mv $ROOT/log.txt $ROOT/logs/bad/$b
    else
        echo ok
        mv $ROOT/log.txt $ROOT/logs/good/$b
    fi
    cd ../../../../
done
