# HealthKit

[HealthKit](https://developer.apple.com/healthkit/) is Apple's toolkit for
aggregating health measurements from iOS devices. It collects sensor
measurements from your iPhone and Apple Watch, as well acting as a central
repository for aggregating data from third party sources that you have opted in
to.

## Exported Data

HealthKit data must be manually exported from the Health app on your iPhone. An
export is a zip file containing two XML files. Of those, the file `export.xml`
contains a series of `Record`s with the following schema:

```
NAME          ATTRIBUTES        EXAMPLE VALUE:
type          CDATA #REQUIRED   "HKQuantityTypeIdentifierDietaryWater"
unit          CDATA #IMPLIED    "mL"
value         CDATA #IMPLIED    "125"
sourceName    CDATA #REQUIRED   "Workflow"
sourceVersion CDATA #IMPLIED    "494"
device        CDATA #IMPLIED
creationDate  CDATA #IMPLIED    "2017-12-28 17:25:33 +0100"
startDate     CDATA #REQUIRED   "2017-12-28 17:25:33 +0100"
endDate       CDATA #REQUIRED   "2017-12-28 17:25:33 +0100"
```


## Imported Data

The `SeriesCollection` proto generated by my
`me::ProcessHealthKitXmlExportOrDie()` functions contains one series for each
`type`. The following schema is used:

```
Series.name                      str
Series.family                    str
Series.unit                      str
Measurement.group                "default"
Measurement.ms_since_unix_epoch  ${startDate} in milliseconds (see below).
Measurement.value                str
Measurement.source               "HealthKit:"${device}
```

The `name`, `family`, `unit`, and `value` fields are handled differently
depending on the `type`, see `health_kit_lib.h` for details. Often the units and
values will be scaled so that all measurements use similar units.

If the measurement type is a time duration, and the end date is different from
the start date, it is split into multiple `Measurement`s, one per day. This is
to ensure that summing the measurements for a day is always <= 24 hours. For
example, an entry has a start date of `2017-01-01 18:00` and an end date of
`2017-01-03 12:00` will produce three measurements:

1.  `2017-01-01 18:00` - `2017-01-02 00:00`
2.  `2017-01-02 00:00` - `2017-01-03 00:00`
3.  `2017-01-03 00:00` - `2017-01-03 12:00`

The `sourceVersion` field is not exported.
