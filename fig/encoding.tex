\lstset{language=[OpenCL]C}
\begin{figure}
  \centering %
  \subfloat[%
    An example, short OpenCL kernel, taken from Nvidia's \emph{streamcluster}.%
  ]{%
    \noindent\mbox{\parbox{\columnwidth}{%
      \lstinputlisting[label=subfig:source_in]{lst/source_in}%
    }}%
  }\\%
  \subfloat[%
    The \emph{streamcluster} kernel after source rewriting. Variable and
    function names are normalized, comments removed, and code style enforced.%
  ]{%
    \noindent\mbox{\parbox{\columnwidth}{%
      \lstinputlisting[label=subfig:source_out]{lst/source_out}%
    }}%
  }\\%
  \subfloat[%
    Derived vocabulary, ordered by their appearance in the
    input~\protect\subref{subfig:source_out}. The vocabulary maps tokens to
    integer indices.%
  ]{%
    \input{tab/vocabulary}%
    \label{subfig:source_vocab}%
  }\\%
  \subfloat[%
    Indices encoded kernel sequence. Sequences may be padded to a fixed length
    by repeating an out-of-vocabulary integer (e.g. -1).%
  ]{%
    \input{tab/encoded}%
    \label{subfig:source_enc}%
  }%
  \caption{%
    Deriving a tokenized $1$-of-$k$ vocabulary encoding from an OpenCL source
    code.%
  }%
  \label{fig:encoding}%
\end{figure}
